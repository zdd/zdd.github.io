<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
<meta property="og:type" content="website">
<meta property="og:title" content="Philip">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Philip">
<meta property="og:description" content="青春都一餉，忍把浮名換了代碼輕狂。">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Philip Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Philip</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Philip</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Philip's blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/20/angular-bindings/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/20/angular-bindings/" class="post-title-link" itemprop="url">angular-bindings</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-07-20 22:03:31" itemprop="dateCreated datePublished" datetime="2024-07-20T22:03:31+08:00">2024-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-21 21:22:48" itemprop="dateModified" datetime="2024-07-21T21:22:48+08:00">2024-07-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>In Angular, there are several ways to bind data to the view, including text interpolation, property binding, class&#x2F;style bindings, and event binding. In this article, we’ll cover the basics of these bindings.</p>
<p>In an Angular template, a binding creates a live connection between a part of the UI created from a template(a DOM element, directive, or component) and the model(the component instance to which the template belongs). This connection can be used to synchronize the view with the model, to notify the model when an event or user action takes place in the view, or both. Angular’s Change Detection algorithm is responsible for keeping the view and the model in sync.</p>
<h2 id="Text-interpolation"><a href="#Text-interpolation" class="headerlink" title="Text interpolation"></a>Text interpolation</h2><p>Text interpolation refers to embedding expressions into marked up text, Angular use <code>&#123;&#123;&#125;&#125;</code> to interpolate expressions into HTML.</p>
<p>Suppose you have a variable <code>name</code> in the component, you can use it in the template like this:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello, &#123;&#123;name&#125;&#125;!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Or if you want to display an image based on its URL, you can do this:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;imageUrl&#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;image&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can also use conditional expressions in text interpolation, for example:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Performance: &#123;&#123; score &gt; 90 ? &#x27;Exceeded&#x27; : &#x27;Match&#x27; &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Or even a function call:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Performance: &#123;&#123; getPerformance() &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Note: text interpolation only works on <code>string</code>, for all other types, Angular will first convert it to string then interpolate it.</p>
<h2 id="Property-binding"><a href="#Property-binding" class="headerlink" title="Property binding"></a>Property binding</h2><p>Property binding in Angular helps you set values for properties of HTML elements or directives.</p>
<p>Property binding moves a value in one direction, from a component’s property into a target element property. In the following example, the <code>src</code> property of the <code>img</code> element is bound to the <code>imageUrl</code> property of the component.</p>
<p><img src="/../images/angular-property-binding.jpg" alt="angular-property-binding"></p>
<h3 id="Property-binding-syntax"><a href="#Property-binding-syntax" class="headerlink" title="Property binding syntax"></a>Property binding syntax</h3><p>You should enclose the HTML element property with <code>[]</code>, and put the component’s property in <code>&quot;&quot;</code>. In this way angular will parse the content in quotes as a variable. the following code won’t work, since angular will treat <code>imageUrl</code> as a string, not a variable in component.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;imageUrl&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;image&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Text interpolation can also be used interchangeably with property binding, the following code has the same effects.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;imageUrl&#125;&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;image&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Class-x2F-Style-bindings"><a href="#Class-x2F-Style-bindings" class="headerlink" title="Class&#x2F;Style bindings"></a>Class&#x2F;Style bindings</h2><h3 id="Class-bindings"><a href="#Class-bindings" class="headerlink" title="Class bindings"></a>Class bindings</h3><p>If you only need single class&#x2F;style binding, you can use the following syntax.<br>Where <code>grade</code> is a variable in the component, and this works as long as <code>grade</code> is a truthy value.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">class.grade</span>]=<span class="string">&quot;grade&quot;</span>&gt;</span>Student A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>class bindings works the same as <code>ngClass</code> directive, see <a target="_blank" rel="noopener" href="https://zdd.github.io/2024/07/20/angular-ng-class/">here</a> for details.</p>
<h3 id="Style-bindings"><a href="#Style-bindings" class="headerlink" title="Style bindings"></a>Style bindings</h3><p>Style bindings works like class bindings, see <a target="_blank" rel="noopener" href="https://angular.dev/guide/templates/class-binding#binding-to-a-single-style">here</a>, we rarely use style bindings, since we always put styles into a single file, but its good to know.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a target="_blank" rel="noopener" href="https://angular.dev/guide/templates">https://angular.dev/guide/templates</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/20/angular-ng-class/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/20/angular-ng-class/" class="post-title-link" itemprop="url">angular-ng-class</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-07-20 21:59:20" itemprop="dateCreated datePublished" datetime="2024-07-20T21:59:20+08:00">2024-07-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-21 09:59:32" itemprop="dateModified" datetime="2024-07-21T09:59:32+08:00">2024-07-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><code>ngClass</code> is a directive in Angular that allows you to add or remove classes on an HTML element.</p>
<h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p>First, create a <code>Student</code> component in your app.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng generate component student</span><br></pre></td></tr></table></figure>

<h2 id="1-import-NgClass-from-angular-common"><a href="#1-import-NgClass-from-angular-common" class="headerlink" title="1. import NgClass from @angular/common;"></a>1. import <code>NgClass</code> from <code>@angular/common</code>;</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">NgClass</span>&#125; <span class="keyword">from</span> <span class="string">&quot;@angular/common&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-Add-NgClass-to-the-imports-array-in-the-component-x2F-module"><a href="#2-Add-NgClass-to-the-imports-array-in-the-component-x2F-module" class="headerlink" title="2. Add NgClass to the imports array in the component&#x2F;module;"></a>2. Add <code>NgClass</code> to the <code>imports</code> array in the component&#x2F;module;</h2><p>We’re using standalone component here.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-student&#x27;</span>,</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./student.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">NgClass</span>], <span class="comment">// &lt;--- here</span></span><br><span class="line">  <span class="attr">styleUrls</span>: [<span class="string">&#x27;./student.component.css&#x27;</span>]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="3-Use-the-ngClass-directive-in-the-HTML-template"><a href="#3-Use-the-ngClass-directive-in-the-HTML-template" class="headerlink" title="3. Use the ngClass directive in the HTML template."></a>3. Use the <code>ngClass</code> directive in the HTML template.</h2><p>We’ll categorize students based on their grades, different grades will have different colors.</p>
<p><code>ngClass</code> accepts <code>string</code>, <code>array</code>, <code>object</code>, <code>map</code>, <code>set</code>, <code>function</code>, and <code>binding to a CSS class</code>. we’ll use all of them in the following examples.</p>
<h3 id="1-String-syntax"><a href="#1-String-syntax" class="headerlink" title="1. String syntax"></a>1. String syntax</h3><p>Note, since <code>ngClass</code> is a property binding, we need to wrap the class name in <code>&#39;&#39;</code> to make it a hard-coded string, otherwise the class name will be treated as a variable in your component.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#x27;grade-A&#x27;&quot;</span>&gt;</span>Student A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>ngClass</code> is commonly used to bind a variable in component, for example, we can define a variable <code>grade</code> in the component, and bind it to the <code>ngClass</code> directive.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grade = <span class="string">&#x27;grade-A&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;grade&quot;</span>&gt;</span>Student A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>If you want to apply a class without a condition, you can simply use the following syntax.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grade-A&quot;</span>&gt;</span>Student A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Array-syntax"><a href="#2-Array-syntax" class="headerlink" title="2. Array syntax"></a>2. Array syntax</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;[&#x27;grade-A&#x27;, &#x27;grade-B&#x27;]&quot;</span>&gt;</span>Student B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-Object-syntax"><a href="#3-Object-syntax" class="headerlink" title="3. Object syntax"></a>3. Object syntax</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;grade-A&#x27;: true, &#x27;grade-B&#x27;: false&#125;&quot;</span>&gt;</span>Student C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-Map-syntax"><a href="#4-Map-syntax" class="headerlink" title="4. Map syntax"></a>4. Map syntax</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;gradeMap&quot;</span>&gt;</span>Student D<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gradeMap = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="built_in">boolean</span>&gt;([</span><br><span class="line">  [<span class="string">&#x27;grade-A&#x27;</span>, <span class="literal">true</span>],</span><br><span class="line">  [<span class="string">&#x27;grade-B&#x27;</span>, <span class="literal">false</span>]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="5-Set-syntax"><a href="#5-Set-syntax" class="headerlink" title="5. Set syntax"></a>5. Set syntax</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;gradeSet&quot;</span>&gt;</span>Student E<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradeSet = <span class="keyword">new</span> <span class="title class_">Set</span>&lt;<span class="built_in">string</span>&gt;([<span class="string">&#x27;grade-A&#x27;</span>, <span class="string">&#x27;grade-B&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p><span style="color:#d7520e">With any object-like bindings such as <code>Array</code>, <code>Object</code>, <code>Map</code>, and <code>Set</code> syntax, the identity of the object must change for Angular to apply the new class. Updating the property without changing the identify has no effect</span>, for example:</p>
<p>This one doest not work, because <code>gradeObject</code> is the same object.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">gradeObject</span>[<span class="string">&quot;grade-b&quot;</span>] = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>This one works, because <code>gradeObject</code> is a new object.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">gradeObject</span> = &#123;...<span class="variable language_">this</span>.<span class="property">gradeObject</span>, <span class="string">&quot;grade-b&quot;</span>: <span class="literal">false</span>&#125;;</span><br></pre></td></tr></table></figure>

<p>Note that, <code>Map</code> and <code>Set</code> syntax are rarely used, <code>object</code> and <code>array</code> syntax are the most common.</p>
<h3 id="6-Expression-syntax"><a href="#6-Expression-syntax" class="headerlink" title="6. Expression syntax"></a>6. Expression syntax</h3><p><code>grade</code> is a component variable, we can use it in the expression.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`html</span></span><br><span class="line"><span class="string">&lt;div [ngClass]=&quot;grade === &#x27;isGradeA&#x27; ? &#x27;grade-A&#x27; : &#x27;&#x27;&quot;&gt;Student F&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-Function-syntax"><a href="#7-Function-syntax" class="headerlink" title="7. Function syntax"></a>7. Function syntax</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;getGrade()&quot;</span>&gt;</span>Student F<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getGrade</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;grade-A&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Difference-between-ngClass-and-class"><a href="#Difference-between-ngClass-and-class" class="headerlink" title="Difference between [ngClass] and [class]"></a>Difference between <code>[ngClass]</code> and <code>[class]</code></h2><p><code>[ngClass]</code> is a directive that allows you to add or remove classes based on conditions, while <code>[class]</code> is a property binding that allows you to add a class without a condition.</p>
<p>Most of the above case can be achieved by <code>[class]</code> as well, except the following case.</p>
<p>This one works</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">ngClass</span>]=<span class="string">&quot;&#123;&#x27;grade-a grade-b&#x27;: true&#125;&quot;</span>&gt;</span>Student<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>But this one <code>doesn&#39;t</code> work</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> [<span class="attr">class</span>]=<span class="string">&quot;&#123;&#x27;grade-a grade-b&#x27;: true&#125;&quot;</span>&gt;</span>Student<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://angular.dev/api/common/NgClass?tab=api">https://angular.dev/api/common/NgClass?tab=api</a></li>
<li><a target="_blank" rel="noopener" href="https://angular.dev/guide/directives#import-ngclass-in-the-component">https://angular.dev/guide/directives#import-ngclass-in-the-component</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/17/great-blogs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/17/great-blogs/" class="post-title-link" itemprop="url">great-blogs</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-07-17 20:45:33" itemprop="dateCreated datePublished" datetime="2024-07-17T20:45:33+08:00">2024-07-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-20 04:46:13" itemprop="dateModified" datetime="2024-07-20T04:46:13+08:00">2024-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><a target="_blank" rel="noopener" href="https://thehistoryoftheweb.com/">The history of the web</a></li>
<li><a target="_blank" rel="noopener" href="https://web.archive.org/">web archive</a></li>
<li><a target="_blank" rel="noopener" href="https://webdevelopmenthistory.com/">Web development history</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/17/javascript-the-most-powerful-line-of-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/17/javascript-the-most-powerful-line-of-code/" class="post-title-link" itemprop="url">javascript-the-most-powerful-line-of-code</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-07-17 20:22:36 / Modified: 20:24:10" itemprop="dateCreated datePublished" datetime="2024-07-17T20:22:36+08:00">2024-07-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>From Quora: <a target="_blank" rel="noopener" href="https://www.quora.com/What-is-the-most-elegant-piece-of-JavaScript-code-you-can-write">https://www.quora.com/What-is-the-most-elegant-piece-of-JavaScript-code-you-can-write</a></p>
<p>I actually have two candidates for the title of “most powerful line of code ever written in JavaScript”. The first is this line:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element.innerHTML = &quot;...&quot;; </span><br></pre></td></tr></table></figure>

<p>The innerHTML property was introduced by Microsoft in the Internet Explorer 4.0 browser (IE4), which was released in October 1997. Prior to this, the only way to modify the HTML content of a page from JavaScript was using the document.write method. Unfortunately, calling document.write on a loaded document automatically calls document.open, which clears the entire document. In other words, it was only with the introduction of innerHTML that JavaScript gained the ability to modify a specific portion of a page, by inserting a bit of arbitrary HTML inside an existing element. And thus, modern Web applications were born.</p>
<p>My other candidate is this line:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); </span><br></pre></td></tr></table></figure>

<p>Prior to this, content could only be downloaded into the browser by requesting a whole new page. Developers resorted to all sorts of tricks, primarily using hidden frames, to circumvent this limitation, but such code was very unwieldy, and had problematic side-effects. It was Microsoft again that changed the game by introducing the XMLHttpRequest object in Internet Explorer 5.0 (IE5) in March 1999. And just like that, AJAX was created, and along with it Single-Page Applications, and the modern Web we know today.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/17/javascript-logical-or-operator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/17/javascript-logical-or-operator/" class="post-title-link" itemprop="url">javascript-logical-or-operator</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-07-17 19:53:40 / Modified: 20:12:24" itemprop="dateCreated datePublished" datetime="2024-07-17T19:53:40+08:00">2024-07-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="How-logical-or-operator-works-in-JavaScript"><a href="#How-logical-or-operator-works-in-JavaScript" class="headerlink" title="How logical or || operator works in JavaScript"></a>How logical or <code>||</code> operator works in JavaScript</h2><p>Consider the following expression, what’s the evaluated result?</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`expr1 || expr2`</span></span><br></pre></td></tr></table></figure>

<p>If <code>expr1</code> can be converted to <code>true</code>, return <code>expr1</code>. Otherwise, return <code>expr2</code>.<br>So we have the following truth:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span> || <span class="literal">true</span>; <span class="comment">// t || t returns true</span></span><br><span class="line"><span class="literal">false</span> || <span class="literal">true</span>; <span class="comment">// f || t returns true</span></span><br><span class="line"><span class="literal">true</span> || <span class="literal">false</span>; <span class="comment">// t || f returns true</span></span><br><span class="line"><span class="literal">false</span> || <span class="number">3</span> === <span class="number">4</span>; <span class="comment">// f || f returns false</span></span><br><span class="line"><span class="string">&quot;Cat&quot;</span> || <span class="string">&quot;Dog&quot;</span>; <span class="comment">// t || t returns &quot;Cat&quot;</span></span><br><span class="line"><span class="literal">false</span> || <span class="string">&quot;Cat&quot;</span>; <span class="comment">// f || t returns &quot;Cat&quot;</span></span><br><span class="line"><span class="string">&quot;Cat&quot;</span> || <span class="literal">false</span>; <span class="comment">// t || f returns &quot;Cat&quot;</span></span><br><span class="line"><span class="string">&quot;&quot;</span> || <span class="literal">false</span>; <span class="comment">// f || f returns false</span></span><br><span class="line"><span class="literal">false</span> || <span class="string">&quot;&quot;</span>; <span class="comment">// f || f returns &quot;&quot;</span></span><br><span class="line"><span class="literal">false</span> || varObject; <span class="comment">// f || object returns varObject</span></span><br></pre></td></tr></table></figure>

<h2 id="in-javascript-not-always-return-boolean-true-or-false"><a href="#in-javascript-not-always-return-boolean-true-or-false" class="headerlink" title="|| in javascript not always return boolean(true or false)"></a><code>||</code> in javascript not always return boolean(<code>true</code> or <code>false</code>)</h2><p>Note that <code>||</code> in javascript is quit difference from <code>||</code> in other languages. For example, in Java, <code>||</code> returns Boolean(<code>true</code> or <code>false</code>), but in JavaScript, it returns the value of one of the operands.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span> || <span class="number">1</span>; <span class="comment">// returns 1</span></span><br><span class="line"><span class="literal">false</span> || <span class="string">&quot;&quot;</span>; <span class="comment">// returns &quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>If you want to convert the value to boolean, you can use double <code>!!</code> or <code>Boolean()</code></p>
<ul>
<li>!!expr - convert to boolean</li>
<li>Boolean(expr) - convert to boolean</li>
</ul>
<h2 id="Short-circuit"><a href="#Short-circuit" class="headerlink" title="Short circuit"></a>Short circuit</h2><p><code>||</code> is a short-circuit operator, which means if the first operand is <code>true</code>, it will not evaluate the second operand.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span> || <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span>); <span class="comment">// nothing output</span></span><br></pre></td></tr></table></figure>

<h2 id="vs"><a href="#vs" class="headerlink" title="|| vs ??"></a><code>||</code> vs <code>??</code></h2><p><code>||</code> and <code>??</code> are both used to provide a default value, but they have different behaviors, if you only care about <code>null</code> or <code>undefined</code>, and treat other <code>Falsy</code> value as valid(for example <code>0</code> or empty string <code>&quot;&quot;</code>) use <code>??</code>, otherwise, use <code>||</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> y = x || <span class="number">10</span>; <span class="comment">// y = 10</span></span><br><span class="line"><span class="keyword">const</span> z = x ?? <span class="number">10</span>; <span class="comment">// z = 0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> b = a || <span class="string">&quot;default&quot;</span>; <span class="comment">// b = &quot;default&quot;</span></span><br><span class="line"><span class="keyword">const</span> c = a ?? <span class="string">&quot;default&quot;</span>; <span class="comment">// c = &quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_OR">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_OR</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_assignment">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_assignment</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/17/javascript-nullish-coalescing-operator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/17/javascript-nullish-coalescing-operator/" class="post-title-link" itemprop="url">javascript-nullish-coalescing-operator</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-07-17 19:47:18 / Modified: 19:47:45" itemprop="dateCreated datePublished" datetime="2024-07-17T19:47:18+08:00">2024-07-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/17/javascript-xxx-is-not-a-function/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/17/javascript-xxx-is-not-a-function/" class="post-title-link" itemprop="url">javascript-xxx is not a function</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-07-17 17:19:23 / Modified: 19:25:32" itemprop="dateCreated datePublished" datetime="2024-07-17T17:19:23+08:00">2024-07-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Have you ever seen this error: “TypeError: xxx is not a function”? This error occurs when you try to call a function that does not exist.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Philip&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">person.<span class="title function_">getAge</span>(); <span class="comment">// TypeError: person.getAge is not a function</span></span><br></pre></td></tr></table></figure>

<p>You can solve this by the <code>optional chaining</code> operator <code>?.</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person.<span class="property">getAge</span>?.(); <span class="comment">// nothing output</span></span><br></pre></td></tr></table></figure>

<p>However, if there is a property in the object has the same name by accident, you will still get that error</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;Philip&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span>,</span><br><span class="line">  <span class="attr">getAge</span>: <span class="number">18</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">person.<span class="property">getAge</span>?.(); <span class="comment">// TypeError: person.getAge is not a function</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/16/jest-test-async-functions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/16/jest-test-async-functions/" class="post-title-link" itemprop="url">jest-test-async-functions</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-07-16 21:06:00" itemprop="dateCreated datePublished" datetime="2024-07-16T21:06:00+08:00">2024-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-17 14:58:31" itemprop="dateModified" datetime="2024-07-17T14:58:31+08:00">2024-07-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Test-promise"><a href="#Test-promise" class="headerlink" title="Test promise"></a>Test promise</h1><p>How many ways to test an async function which has a promise with jest in an angular app? suppose you have the following function</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To test this function, you can use the following ways:</p>
<h2 id="1-Using-async-x2F-await"><a href="#1-Using-async-x2F-await" class="headerlink" title="1. Using async&#x2F;await"></a>1. Using async&#x2F;await</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should return 10&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">getData</span>();</span><br><span class="line">  <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="2-By-returning-promise"><a href="#2-By-returning-promise" class="headerlink" title="2. By returning promise"></a>2. By returning promise</h2><p>In jest, when you return a promise in your test, jest will wait for the promise to resolve.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should return 10&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">getData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="3-By-a-done-callback"><a href="#3-By-a-done-callback" class="headerlink" title="3. By a done callback"></a>3. By a <code>done</code> callback</h2><p>This one works fine when promise is resolved. but if the promise is rejected, the test will wait for a maximum of 5 seconds timeout, and then fail. while others will fail immediately.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should return 10&#x27;</span>, <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="4-By-waitForAsync-in-angular"><a href="#4-By-waitForAsync-in-angular" class="headerlink" title="4. By waitForAsync in angular"></a>4. By <code>waitForAsync</code> in angular</h2><p>In angular, you can use <code>waitForAsync</code> to test async functions. Note that you don’t need <code>await</code> in this case.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should return 10&#x27;</span>, <span class="title function_">waitForAsync</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<h2 id="5-Using-fakeAsync-in-angular"><a href="#5-Using-fakeAsync-in-angular" class="headerlink" title="5. Using fakeAsync in angular"></a>5. Using <code>fakeAsync</code> in angular</h2><p>In angular, you can use <code>fakeAsync</code> to test async functions. Note that you don’t need <code>flush</code> or <code>tick</code> in this case.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should return 10&#x27;</span>, <span class="title function_">fakeAsync</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">flush</span>();</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<h2 id="6-This-one-not-work"><a href="#6-This-one-not-work" class="headerlink" title="6. This one not work!"></a>6. This one not work!</h2><p>Since we have a <code>setTimeout</code> in the <code>getData</code> function, the following test will fail.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should return 10&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>if getData() doesn’t have a <code>setTimeout</code>, the above test will work.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Test-observable"><a href="#Test-observable" class="headerlink" title="Test observable"></a>Test observable</h1><p>How many ways to test an async function which returns an observable with jest in an angular app? suppose you have the following function</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Observable</span>(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      observer.<span class="title function_">next</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-Test-with-done-callback"><a href="#1-Test-with-done-callback" class="headerlink" title="1. Test with done callback"></a>1. Test with <code>done</code> callback</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should complete with value 10&#x27;</span>, <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">  component.<span class="title function_">getData</span>().<span class="title function_">subscribe</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="2-Test-by-convert-observable-to-promise"><a href="#2-Test-by-convert-observable-to-promise" class="headerlink" title="2. Test by convert observable to promise"></a>2. Test by convert observable to promise</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should complete with value 10&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">expect</span>(<span class="title function_">firstValueFrom</span>(component.<span class="title function_">getData</span>())).<span class="property">resolves</span>.<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="3-Convert-to-promise-manually"><a href="#3-Convert-to-promise-manually" class="headerlink" title="3. Convert to promise manually"></a>3. Convert to promise manually</h2><p>This one is not recommended, Please use <code>firstValueFrom</code> or <code>lastValueFrom</code> from <code>rxjs</code> to convert observable to promise.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;should complete with value 10&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    component.<span class="title function_">getData</span>().<span class="title function_">subscribe</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">expect</span>(result).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">      <span class="title function_">resolve</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/16/jest-from-scratch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/16/jest-from-scratch/" class="post-title-link" itemprop="url">jest-from-scratch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-07-16 09:01:19 / Modified: 21:08:04" itemprop="dateCreated datePublished" datetime="2024-07-16T09:01:19+08:00">2024-07-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In this post, I will show you how to set up a <a target="_blank" rel="noopener" href="https://jestjs.io/">Jest</a> project from scratch. We won’t use any front-end frameworks like <code>React</code>, <code>Angular</code>, or <code>Vue</code>, just a simple vanilla <code>JavaScript</code> project.</p>
<h1 id="CommonJs"><a href="#CommonJs" class="headerlink" title="CommonJs"></a>CommonJs</h1><h2 id="Step-1-Create-a-new-project"><a href="#Step-1-Create-a-new-project" class="headerlink" title="Step 1: Create a new project"></a>Step 1: Create a new project</h2><p>Run the following command to init a new project directory, it will simply create a <code>package.json</code> file in the current directory.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y <span class="comment"># with -y, you don&#x27;t need to answer the questions</span></span><br></pre></td></tr></table></figure>

<h2 id="Step-2-Install-Jest"><a href="#Step-2-Install-Jest" class="headerlink" title="Step 2: Install Jest"></a>Step 2: Install Jest</h2><p>Run the following command to install <code>Jest</code> as a dev dependency.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev jest</span><br></pre></td></tr></table></figure>

<h2 id="Step-3-Create-a-javascript-file"><a href="#Step-3-Create-a-javascript-file" class="headerlink" title="Step 3: Create a javascript file"></a>Step 3: Create a javascript file</h2><p>We’ll first focus on CommonJs, create a new file named <code>sum.js</code> in the root directory of your project, and add the following code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = sum;</span><br></pre></td></tr></table></figure>

<h2 id="Step-4-Create-a-test-file"><a href="#Step-4-Create-a-test-file" class="headerlink" title="Step 4: Create a test file"></a>Step 4: Create a test file</h2><p>Create a new file named <code>sum.test.js</code> in the root directory of your project, and add the following code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="built_in">require</span>(<span class="string">&#x27;./sum&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;adds 1 + 2 to equal 3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>)).<span class="title function_">toBe</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Step-5-Update-package-json"><a href="#Step-5-Update-package-json" class="headerlink" title="Step 5: Update package.json"></a>Step 5: Update <code>package.json</code></h2><p>Add the following line to the <code>scripts</code> property in the <code>package.json</code> file:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Step-6-Run-the-test"><a href="#Step-6-Run-the-test" class="headerlink" title="Step 6: Run the test"></a>Step 6: Run the test</h2><p>Run the following command to run the test:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<h2 id="Run-test-with-coverage"><a href="#Run-test-with-coverage" class="headerlink" title="Run test with coverage"></a>Run test with coverage</h2><p>Run the following command to run the test with coverage:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx jest -- --coverage</span><br></pre></td></tr></table></figure>

<h1 id="ESModule"><a href="#ESModule" class="headerlink" title="ESModule"></a>ESModule</h1><p>To run Jest with ESModule, first rewrite your file and test file to use ESModule syntax.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.test.js</span></span><br><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">&#x27;./sum.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;adds 1 + 2 to equal 3&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>)).<span class="title function_">toBe</span>(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Run the test, you will got following error:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Jest encountered an unexpected token</span><br><span class="line">SyntaxError: Cannot use import statement outside a module</span><br></pre></td></tr></table></figure>

<p>This is because you are trying to use ESModule syntax in a CommonJs environment, to fix this, you can update your file name to <code>sum.test.mjs</code> or you need to add the following line to the <code>package.json</code> file:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;moduleFileExtensions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;js&quot;</span><span class="punctuation">,</span> <span class="string">&quot;mjs&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;transform&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Then run the test again, it still not work, got the following error, it seems that Jest didn’t find any test file with the default pattern.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">No tests found, exiting with code 1</span><br><span class="line">Run with `--passWithNoTests` to <span class="built_in">exit</span> with code 0</span><br><span class="line">In D:\personal\codes\jest</span><br><span class="line">  5 files checked.</span><br><span class="line">  testMatch: **/__tests__/**/*.[jt]s?(x), **/?(*.)+(spec|<span class="built_in">test</span>).[tj]s?(x) - 0 matches</span><br><span class="line">  testPathIgnorePatterns: \\node_modules\\ - 5 matches</span><br><span class="line">  testRegex:  - 0 matches</span><br><span class="line">Pattern:  - 0 matches</span><br></pre></td></tr></table></figure>

<p>Update <code>jest</code> config in <code>package.json</code> file to include <code>mjs</code> file extension in <a target="_blank" rel="noopener" href="https://jestjs.io/docs/next/configuration#testmatch-arraystring">testMatch</a>, see <a target="_blank" rel="noopener" href="https://github.com/micromatch/micromatch">micromatch</a> for detail matching rules. Note: this is <code>not</code> regex.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;testMatch&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;**/?(*.)test.?js&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>Then run the test again, got the previous error again</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SyntaxError: Cannot use import statement outside a module</span><br></pre></td></tr></table></figure>

<p>Then search jest official documentation, change jest command in <code>package.json</code> file to:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node --experimental-vm-modules node_modules/jest/bin/jest.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Then run the test again, it works now.</p>
<h1 id="Using-config-file"><a href="#Using-config-file" class="headerlink" title="Using config file"></a>Using config file</h1><p>You can move the jest config in <code>package.json</code> to a separate file named <code>jest.config.js</code>, and update the <code>package.json</code> file to use the config file.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jest --config jest.config.js&quot;</span></span><br><span class="line">  <span class="attr">&quot;test-esm&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node --experimental-vm-modules node_modules/jest/bin/jest.js --config jest.config.js&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>Then create a new file named <code>jest.config.js</code> in the root directory of your project, and add the following code:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">moduleFileExtensions</span>: [<span class="string">&#x27;js&#x27;</span>, <span class="string">&#x27;mjs&#x27;</span>],</span><br><span class="line">  <span class="attr">transform</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">testMatch</span>: [<span class="string">&#x27;**/?(*.)test.?js&#x27;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Then run the test again, it works now.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/07/15/jest-localstorage-does-not-need-mock-now/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/07/15/jest-localstorage-does-not-need-mock-now/" class="post-title-link" itemprop="url">jest-localstorage-does-not-need-mock-now</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-07-15 20:07:52 / Modified: 21:12:10" itemprop="dateCreated datePublished" datetime="2024-07-15T20:07:52+08:00">2024-07-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="You-don’t-need-to-mock-localStorage-with-latest-jsdom"><a href="#You-don’t-need-to-mock-localStorage-with-latest-jsdom" class="headerlink" title="You don’t need to mock localStorage with latest jsdom"></a>You don’t need to mock <code>localStorage</code> with latest <code>jsdom</code></h1><p>Suppose you have a <code>localStorage</code> utility function like this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// storage-utils.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">saveItem</span>(<span class="params">item: any</span>) &#123;</span><br><span class="line">  <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;item&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(item));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getItem</span>(<span class="params">name: string</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> jsonString = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(name);</span><br><span class="line">  <span class="keyword">if</span> (jsonString) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonString);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To test above code, you have the following test file:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// storage-utils.spec.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; getItem, saveItem &#125; <span class="keyword">from</span> <span class="string">&#x27;./storage-utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;local storage should work&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should set and get item&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> item = &#123; <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;;</span><br><span class="line">    <span class="title function_">saveItem</span>(item);</span><br><span class="line">    <span class="keyword">const</span> storedItem = <span class="title function_">getItem</span>(<span class="string">&#x27;item&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(storedItem).<span class="title function_">toEqual</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>When you run this test with <code>Jest</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># first, navigate to the directory where the test file is located.</span></span><br><span class="line">jest storage-utils.spec.ts</span><br></pre></td></tr></table></figure>
<p>Everything works fine, but <code>localStorage</code> is only available in <code>browser environment</code>, and you didn’t mock it, why?</p>
<p>This is because <code>Jest</code> now use <code>jsdom</code> as the default environment, and <code>jsdom</code> has implemented <code>localStorage</code> and <code>sessionStorage</code> APIs, so you don’t need to mock them anymore.</p>
<p>To test this, you can find the <code>jest.config.js</code> file in the root directory of your project, and add the following line to the <code>testEnvironment</code> property:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">preset</span>: <span class="string">&#x27;jest-preset-angular&#x27;</span>,</span><br><span class="line">  <span class="attr">setupFilesAfterEnv</span>: [<span class="string">&#x27;&lt;rootDir&gt;/setup-jest.ts&#x27;</span>],</span><br><span class="line">  <span class="attr">testEnvironment</span>: <span class="string">&#x27;node&#x27;</span>, <span class="comment">// &lt;-- change this to &#x27;node&#x27;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Then run the test again, you will see the test failed because <code>localStorage</code> is not available in the <code>node</code> environment, and you will get the following error:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localStorage is not defined</span><br><span class="line">ReferenceError: localStorage is not defined</span><br></pre></td></tr></table></figure>

<h1 id="Use-jsdom-by-in-test-file"><a href="#Use-jsdom-by-in-test-file" class="headerlink" title="Use jsdom by in test file"></a>Use <code>jsdom</code> by in test file</h1><p>Suppose you global jest config is <code>node</code>(in file <code>jest.config.js</code> under project root), but you want to use <code>jsdom</code> in some test cases, you can use the following code in the test file, add @jest-environment jsdom at the top of the file.(Don’t use <code>//</code> comment, it will not work)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@jest</span>-environment jsdom</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; getItem, saveItem &#125; <span class="keyword">from</span> <span class="string">&#x27;./storage-utils&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;local storage should work&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should set and get item&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> item = &#123; <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;;</span><br><span class="line">    <span class="title function_">saveItem</span>(item);</span><br><span class="line">    <span class="keyword">const</span> storedItem = <span class="title function_">getItem</span>(<span class="string">&#x27;item&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(storedItem).<span class="title function_">toEqual</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="Mock-localStorage"><a href="#Mock-localStorage" class="headerlink" title="Mock localStorage"></a>Mock <code>localStorage</code></h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mockLocalStorage.ts</span></span><br><span class="line"><span class="keyword">const</span> mockLocalStorage = (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> store = &#123;&#125; <span class="keyword">as</span> <span class="title class_">Storage</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="title function_">getItem</span>(<span class="params">key: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> store[key];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">setItem</span>(<span class="params">key: <span class="built_in">string</span>, value: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      store[key] = value;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">removeItem</span>(<span class="params">key: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="keyword">delete</span> store[key];</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">      store = &#123;&#125; <span class="keyword">as</span> <span class="title class_">Storage</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mockLocalStorage;</span><br></pre></td></tr></table></figure>

<p>Test file, note that we use <code>globalThis</code> here, it’s environment independently, and works both in <code>node</code> and <code>browser</code> environment.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// storage-utils.spec.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; getItem, saveItem &#125; <span class="keyword">from</span> <span class="string">&#x27;./storage-utils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> mockLocalStorage <span class="keyword">from</span> <span class="string">&#x27;./mockLocalStorage&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;local storage should work&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(globalThis, <span class="string">&#x27;localStorage&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">value</span>: mockLocalStorage,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;should set and get item&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> item = &#123; <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;;</span><br><span class="line">    <span class="title function_">saveItem</span>(item);</span><br><span class="line">    <span class="keyword">const</span> storedItem = <span class="title function_">getItem</span>(<span class="string">&#x27;item&#x27;</span>);</span><br><span class="line">    <span class="title function_">expect</span>(storedItem).<span class="title function_">toEqual</span>(item);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h1><ol>
<li><a target="_blank" rel="noopener" href="https://jestjs.io/docs/configuration#testenvironment-string">https://jestjs.io/docs/configuration#testenvironment-string</a> - the official document still said that <code>node</code> is the default environment, but in my case, it’s <code>jsdom</code>, not sure why.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/jsdom/jsdom/blob/main/Changelog.md#11120">https://github.com/jsdom/jsdom/blob/main/Changelog.md#11120</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Philip Zhang</p>
  <div class="site-description" itemprop="description">青春都一餉，忍把浮名換了代碼輕狂。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">150</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">215</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Philip Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
