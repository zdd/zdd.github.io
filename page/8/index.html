<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
<meta property="og:type" content="website">
<meta property="og:title" content="Philip">
<meta property="og:url" content="http://example.com/page/8/index.html">
<meta property="og:site_name" content="Philip">
<meta property="og:description" content="青春都一餉，忍把浮名換了代碼輕狂。">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Philip Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Philip</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Philip</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Philip's blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/03/javascript-always-use-arrow-function-in-settimeout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/03/javascript-always-use-arrow-function-in-settimeout/" class="post-title-link" itemprop="url">javascript-always-use-arrow-function-in-setTimeout</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-03 23:32:47" itemprop="dateCreated datePublished" datetime="2024-10-03T23:32:47+08:00">2024-10-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-10 21:08:01" itemprop="dateModified" datetime="2024-11-10T21:08:01+08:00">2024-11-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="A-question-from-stackoverflow"><a href="#A-question-from-stackoverflow" class="headerlink" title="A question from stackoverflow"></a>A question from stackoverflow</h2><p>The following code does not work, do you know why? When you run the code, you will got the error <code>TypeError: Cannot read properties of undefined (reading &#39;navigate&#39;)</code>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">OnInit</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Router</span>, <span class="title class_">RouterOutlet</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">TestComponent</span>&#125; <span class="keyword">from</span> <span class="string">&quot;./test/test.component&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-root&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">imports</span>: [<span class="title class_">RouterOutlet</span>, <span class="title class_">TestComponent</span>],</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./app.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrl</span>: <span class="string">&#x27;./app.component.scss&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  title = <span class="string">&#x27;angular-18&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> router: Router</span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">gotoProduct</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigate</span>([<span class="string">&#x27;product&#x27;</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="variable language_">this</span>.<span class="property">gotoProduct</span>, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Reason:<br><code>Code executed by setTimeout() is called from an execution context separate from the function from which setTimeout was called. The usual rules for setting the this keyword for the called function apply, and if you have not set this in the call or with bind, it will default to the window (or global) object, even in strict mode. It will not be the same as the this value for the function that called setTimeout.</code> - From <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/setTimeout#the_this_problem">MDN- The this problem for setTimeout</a></p>
<p>That means <code>router</code> is undefined in <code>gotoProduct</code> function. The reason is that <code>this</code> in <code>gotoProduct</code> function is not the instance of <code>AppComponent</code>. It is the instance of <code>Window</code> object. </p>
<p>How to fix it?</p>
<h2 id="Use-Arrow-function"><a href="#Use-Arrow-function" class="headerlink" title="Use Arrow function"></a>Use Arrow function</h2><p>Arrow function doesn’t have its own this binding, it will inherit the <code>this</code> from the parent scope. So, you can use arrow function in <code>setTimeout</code> function to keep the context of the parent scope.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">gotoProduct</span>();</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Use-bind"><a href="#Use-bind" class="headerlink" title="Use bind"></a>Use <code>bind</code></h2><p>You can also use <code>bind</code> function to bind the <code>this</code> to the <code>gotoProduct</code> function.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="variable language_">this</span>.<span class="property">gotoProduct</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>), <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Becareful when using <code>setTimeout</code> function in <code>Angular</code>.<br>Always use arrow function in <code>setTimeout</code> function to keep the context of the parent scope.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/03/angular-host-listener/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/03/angular-host-listener/" class="post-title-link" itemprop="url">angular-host-listener</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-03 12:35:29" itemprop="dateCreated datePublished" datetime="2024-10-03T12:35:29+08:00">2024-10-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-12-04 17:04:51" itemprop="dateModified" datetime="2024-12-04T17:04:51+08:00">2024-12-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><code>HostListener</code> is an Angular <code>Decorator</code> that declares a DOM event to listen for, and provides a handler method to run when that event occurs.</p>
<h2 id="What-is-a-Host"><a href="#What-is-a-Host" class="headerlink" title="What is a Host?"></a>What is a Host?</h2><p>先看一下Host的含义，Host是指Directive或者Component的宿主元素，比如下面这个例子：<code>app-product</code>是<code>ProductComponent</code>的Host。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">app-product</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>Product<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">app-product</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这里<code>app-product</code>是ProductComponent定义时指定的选择器，而ProductComponent的模板也很简单，就是一个<code>div</code>元素，里面的内容是字符串<code>Product</code>。</p>
<p>See <a target="_blank" rel="noopener" href="https://angular.dev/guide/components/host-elements#">here</a> for details.</p>
<p>Here is an example of using <code>HostListener</code> to listen for the <code>click</code> event on a button element:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">HostListener</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-test&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">imports</span>: [],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;button&gt;Click me&lt;/button&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TestComponent</span> &#123;</span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;click&#x27;</span>)</span><br><span class="line">  <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Button clicked&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The above code is equivalent to the following code:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">HostListener</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-test&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">imports</span>: [],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;button (click)=&quot;onClick()&quot;&gt;Click me&lt;/button&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TestComponent</span> &#123;</span><br><span class="line">  <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Button clicked&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>HostListener</code> is a more powerful way to listen for events because it allows you to listen for events on any element, not just the element that the <code>HostListener</code> is attached to. For example, you can listen for the events from document or window object.</p>
<ul>
<li>document:click</li>
<li>window:keydown</li>
<li>window:scroll</li>
<li>window:resize</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">HostListener</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-test&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">imports</span>: [],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;button (click)=&quot;onClick()&quot;&gt;Click me&lt;/button&gt;</span></span><br><span class="line"><span class="string">  `</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TestComponent</span> &#123;</span><br><span class="line">  <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Button clicked&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;document:click&#x27;</span>, [<span class="string">&#x27;$event&#x27;</span>])</span><br><span class="line">  <span class="title function_">documentClick</span>(<span class="params">event: MouseEvent</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Document clicked at (<span class="subst">$&#123;event.clientX&#125;</span>, <span class="subst">$&#123;event.clientY&#125;</span>)`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;window:keydown&#x27;</span>, [<span class="string">&#x27;$event&#x27;</span>])</span><br><span class="line">  <span class="title function_">keydown</span>(<span class="params">event: KeyboardEvent</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`event.key: <span class="subst">$&#123;event.key&#125;</span> was pressed`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;window:scroll&#x27;</span>, [<span class="string">&#x27;$event&#x27;</span>])</span><br><span class="line">  <span class="title function_">onScroll</span>(<span class="params">event: Event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Window scrolled`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@HostListener</span>(<span class="string">&#x27;window:resize&#x27;</span>, [<span class="string">&#x27;$event&#x27;</span>])</span><br><span class="line">  <span class="title function_">onResize</span>(<span class="params">event: Event</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Window resized`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a target="_blank" rel="noopener" href="https://angular.dev/api/core/HostListener?tab=usage-notes">https://angular.dev/api/core/HostListener?tab=usage-notes</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/03/angular-module-federation-deep-dive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/03/angular-module-federation-deep-dive/" class="post-title-link" itemprop="url">angular-module-federation-deep-dive</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-10-03 10:37:03 / Modified: 11:19:53" itemprop="dateCreated datePublished" datetime="2024-10-03T10:37:03+08:00">2024-10-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this article, we will explore the Angular Module Federation feature in depth. Please read the <a target="_blank" rel="noopener" href="https://zdd.github.io/2024/05/26/angular-module-federation/">first article</a> in this series to get a basic understanding of Module Federation.</p>
<h2 id="remoteEntry-js"><a href="#remoteEntry-js" class="headerlink" title="remoteEntry.js"></a>remoteEntry.js</h2><p>Each time you call <code>loadRemoteModule</code>, Angular will fetch the <code>remoteEntry.js</code> file first from the remote server. What is this file? Let’s take a look at the <code>remoteEntry.js</code> file in the <code>remote</code> project.</p>
<p>You can find the <code>remoteEntry.js</code> file in the <code>dist</code> folder of the <code>remote</code> project. The file is generated by the ModuleFederationPlugin in the webpack configuration. But the file under the <code>dist</code> folder is minimized and hard to read. You can read it on Chrome network tab when you call <code>loadRemoteModule</code>.</p>
<p>This file is very large and contains lots of code, you can scroll down to the bottom or search <code>container entry</code> to find key part.</p>
<p>remoteEntry.js mainly contains the following information:</p>
<h3 id="1-The-list-of-modules-that-are-exposed-by-the-remote-project"><a href="#1-The-list-of-modules-that-are-exposed-by-the-remote-project" class="headerlink" title="1. The list of modules that are exposed by the remote project."></a>1. The list of modules that are exposed by the remote project.</h3><p>In the following example, the remote project exposes a module named <code>./Component</code> from its <code>./projects/mfe1/src/app/product/product.component.ts</code> file.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> moduleMap = &#123;</span><br><span class="line">	<span class="string">&quot;./Component&quot;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> __webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;projects_mfe1_src_app_product_product_component_ts&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> ((<span class="title function_">__webpack_require__</span>(<span class="comment">/*! ./projects/mfe1/src/app/product/product.component.ts */</span> <span class="number">1585</span>)))));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="2-The-list-of-shared-libraries"><a href="#2-The-list-of-shared-libraries" class="headerlink" title="2. The list of shared libraries."></a>2. The list of shared libraries.</h3><p>From the following code in remoteEntry.js the remote project shares the common angular and rxjs libraries.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(name) &#123;</span><br><span class="line"> 	<span class="keyword">case</span> <span class="string">&quot;default&quot;</span>: &#123;</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;@angular/common/http&quot;</span>, <span class="string">&quot;17.3.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_angular_common_fesm2022_http_mjs-_f9340&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">6443</span>))))));</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;@angular/common&quot;</span>, <span class="string">&quot;17.3.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_angular_common_fesm2022_common_mjs-_b4621&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">316</span>))))));</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;@angular/core/primitives/signals&quot;</span>, <span class="string">&quot;17.3.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_angular_core_fesm2022_primitives_signals_mjs&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">5689</span>))))));</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;@angular/core&quot;</span>, <span class="string">&quot;17.3.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_angular_core_fesm2022_core_mjs&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">7580</span>))))));</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;@angular/platform-browser&quot;</span>, <span class="string">&quot;17.3.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_angular_platform-browser_fesm2022_platform-browser_mjs-_e89f0&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">436</span>))))));</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;@angular/router&quot;</span>, <span class="string">&quot;17.3.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_angular_router_fesm2022_router_mjs-_5a221&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">5072</span>))))));</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;rxjs/operators&quot;</span>, <span class="string">&quot;7.8.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_rxjs_dist_esm_operators_index_js&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">8219</span>))))));</span><br><span class="line"> 		<span class="title function_">register</span>(<span class="string">&quot;rxjs&quot;</span>, <span class="string">&quot;7.8.0&quot;</span>, <span class="function">() =&gt;</span> (__webpack_require__.<span class="title function_">e</span>(<span class="string">&quot;node_modules_rxjs_dist_esm_index_js&quot;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> (<span class="function">() =&gt;</span> (<span class="title function_">__webpack_require__</span>(<span class="number">845</span>))))));</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><ol>
<li>remoteEntry.js is a file that contains the list of modules that are exposed by the remote project.</li>
<li>Angular fetches the remoteEntry.js file first before loading the remote module.</li>
<li>The remoteEntry.js file is generated by the ModuleFederationPlugin in the webpack configuration.</li>
<li>shell&#x2F;host project does not have a remoteEntry.js file.</li>
</ol>
<h2 id="loadRemoteModule"><a href="#loadRemoteModule" class="headerlink" title="loadRemoteModule"></a>loadRemoteModule</h2><p>How loadRemoteModule works in Angular Module Federation? Let’s take a look at the source code of the <code>loadRemoteModule</code> function in the <code>@angular-architects/module-federation</code> package.</p>
<p>The entry point is from the router file, we call <code>loadRemoteModule</code> function to load the remote module. The <code>loadRemoteModule</code> function is defined in the <code>load-remote-module.ts</code> file in the <code>@angular-architects/module-federation</code> package.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;product&#x27;</span>,</span><br><span class="line">  <span class="attr">loadComponent</span>: <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">loadRemoteModule</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">      <span class="attr">remoteEntry</span>: <span class="string">&#x27;http://localhost:4201/remoteEntry.js&#x27;</span>,</span><br><span class="line">      <span class="attr">exposedModule</span>: <span class="string">&#x27;./Component&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">m</span> =&gt;</span> m.<span class="property">ProductComponent</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here is the source code of the <code>loadRemoteModule</code> function from <code>webpack:///node_modules/@angular-architects/module-federation-runtime/fesm2022/angular-architects-module-federation-runtime.mjs</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadRemoteModule</span>(<span class="params">optionsOrRemoteName, exposedModule</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> loadRemoteEntryOptions;</span><br><span class="line">    <span class="keyword">let</span> key;</span><br><span class="line">    <span class="keyword">let</span> remoteEntry;</span><br><span class="line">    <span class="keyword">let</span> options;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> optionsOrRemoteName === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        options = &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;manifest&#x27;</span>,</span><br><span class="line">            <span class="attr">remoteName</span>: optionsOrRemoteName,</span><br><span class="line">            <span class="attr">exposedModule</span>: exposedModule,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        options = optionsOrRemoteName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// To support legacy API (&lt; ng 13)</span></span><br><span class="line">    <span class="keyword">if</span> (!options.<span class="property">type</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> hasManifest = <span class="title class_">Object</span>.<span class="title function_">keys</span>(config).<span class="property">length</span> &gt; <span class="number">0</span>;</span><br><span class="line">        options.<span class="property">type</span> = hasManifest ? <span class="string">&#x27;manifest&#x27;</span> : <span class="string">&#x27;script&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">type</span> === <span class="string">&#x27;manifest&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> manifestEntry = config[options.<span class="property">remoteName</span>];</span><br><span class="line">        <span class="keyword">if</span> (!manifestEntry) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Manifest does not contain &#x27;</span> + options.<span class="property">remoteName</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        options = &#123;</span><br><span class="line">            <span class="attr">type</span>: manifestEntry.<span class="property">type</span>,</span><br><span class="line">            <span class="attr">exposedModule</span>: options.<span class="property">exposedModule</span>,</span><br><span class="line">            <span class="attr">remoteEntry</span>: manifestEntry.<span class="property">remoteEntry</span>,</span><br><span class="line">            <span class="attr">remoteName</span>: manifestEntry.<span class="property">type</span> === <span class="string">&#x27;script&#x27;</span> ? options.<span class="property">remoteName</span> : <span class="literal">undefined</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        remoteEntry = manifestEntry.<span class="property">remoteEntry</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        remoteEntry = options.<span class="property">remoteEntry</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">type</span> === <span class="string">&#x27;script&#x27;</span>) &#123;</span><br><span class="line">        loadRemoteEntryOptions = &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;script&#x27;</span>,</span><br><span class="line">            <span class="attr">remoteEntry</span>: options.<span class="property">remoteEntry</span>,</span><br><span class="line">            <span class="attr">remoteName</span>: options.<span class="property">remoteName</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        key = options.<span class="property">remoteName</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (options.<span class="property">type</span> === <span class="string">&#x27;module&#x27;</span>) &#123;</span><br><span class="line">        loadRemoteEntryOptions = &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">            <span class="attr">remoteEntry</span>: options.<span class="property">remoteEntry</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        key = options.<span class="property">remoteEntry</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (remoteEntry) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="title function_">loadRemoteEntry</span>(loadRemoteEntryOptions);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">lookupExposedModule</span>(key, options.<span class="property">exposedModule</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The key part is the last <code>if</code> branch in this file.<br>first: it load the <code>remoteEntry.js</code> file by calling <code>loadRemoteEntry</code> function.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (remoteEntry) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">loadRemoteEntry</span>(loadRemoteEntryOptions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>loadREmoteEntry</code> function then calls <code>loadRemoteModuleEntry</code> function to load the remote module.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// remoteEntry = &#x27;http://localhost:4201/remoteEntry.js&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadRemoteModuleEntry</span>(<span class="params">remoteEntry</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (containerMap[remoteEntry]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">import</span>(<span class="comment">/* webpackIgnore:true */</span> remoteEntry).<span class="title function_">then</span>(<span class="function">(<span class="params">container</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">initRemote</span>(container, remoteEntry);</span><br><span class="line">        containerMap[remoteEntry] = container;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can see that it uses the <code>import</code> function to load the remoteEntry.js file. The <code>import</code> function is a dynamic import function that fetches the remoteEntry.js file from the remote server. After loading the remoteEntry.js file, it calls the <code>initRemote</code> function to initialize the remote container. This container is used to get the remote module later.</p>
<p>After loading the remoteEntry.js file, then it calls <code>lookupExposedModule</code> function to get the module from the remote project.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// key = &#x27;http://localhost:4201/remoteEntry.js&#x27;</span></span><br><span class="line"><span class="comment">// exposedModule = &#x27;./Component&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">lookupExposedModule</span>(<span class="params">key, exposedModule</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> container = containerMap[key];</span><br><span class="line">  <span class="keyword">const</span> factory = <span class="keyword">await</span> container.<span class="title function_">get</span>(exposedModule);</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Module</span> = <span class="title function_">factory</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Module</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/02/angular-constructor-vs-ngoninit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/02/angular-constructor-vs-ngoninit/" class="post-title-link" itemprop="url">angular-constructor-vs-ngoninit</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-02 10:10:20" itemprop="dateCreated datePublished" datetime="2024-10-02T10:10:20+08:00">2024-10-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-27 21:01:51" itemprop="dateModified" datetime="2024-11-27T21:01:51+08:00">2024-11-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Constructor-vs-ngOnInit"><a href="#Constructor-vs-ngOnInit" class="headerlink" title="Constructor vs ngOnInit"></a>Constructor vs ngOnInit</h2><p>What’s the difference between constructor and ngOnInit in Angular?<br><code>constructor</code> is a TypeScript class constructor while <code>ngOnInit</code> is an Angular lifecycle hook called by <code>Angular</code> to indicate that Angular is done creating the component. a common question is when to use <code>constructor</code> and when to use <code>ngOnInit</code>?</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">OnInit</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-product&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">imports</span>: [],</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./product.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrl</span>: <span class="string">&#x27;./product.component.scss&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ProductComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// What should be done here?</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// What should be done here?</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>constructor</code> is used to initialize the class properties, but it’s not the right place to do any initialization that depends on Angular services or inputs. ngOnInit is the right place to do such initialization.</li>
<li><code>ngOnInit</code> is an Angular lifecycle hook that is called after Angular has initialized all data-bound properties of a directive. It’s the right place to put initialization logic that depends on Angular services or inputs.</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Component</span>, <span class="title class_">OnInit</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">DataService</span>&#125; <span class="keyword">from</span> <span class="string">&quot;../data.service&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  <span class="attr">selector</span>: <span class="string">&#x27;app-product&#x27;</span>,</span><br><span class="line">  <span class="attr">standalone</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">imports</span>: [],</span><br><span class="line">  <span class="attr">templateUrl</span>: <span class="string">&#x27;./product.component.html&#x27;</span>,</span><br><span class="line">  <span class="attr">styleUrl</span>: <span class="string">&#x27;./product.component.scss&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ProductComponent</span> <span class="keyword">implements</span> <span class="title class_">OnInit</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">products</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> dataService: DataService</span>) &#123;</span><br><span class="line">    <span class="comment">// What should be done here?</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">ngOnInit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dataService</span>.<span class="title function_">fetchData</span>().<span class="title function_">subscribe</span>(<span class="function">(<span class="params">data: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">products</span> = data;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><table>
<thead>
<tr>
<th></th>
<th>When to call</th>
<th>Call count</th>
<th>What to do</th>
<th>Comments</th>
</tr>
</thead>
<tbody><tr>
<td>constructor</td>
<td>When create class</td>
<td>1</td>
<td>1. Initialize class properties, 2. DI</td>
<td></td>
</tr>
<tr>
<td>ngOnInit</td>
<td>after <code>constructor</code>, before first <code>ngOnChanges</code></td>
<td>1</td>
<td>1. Init @Input, 2. Call service to fetch data</td>
<td></td>
</tr>
</tbody></table>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/35763730/difference-between-constructor-and-ngoninit">https://stackoverflow.com/questions/35763730/difference-between-constructor-and-ngoninit</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/angular-in-depth/the-essential-difference-between-constructor-and-ngoninit-in-angular-c9930c209a42">https://medium.com/angular-in-depth/the-essential-difference-between-constructor-and-ngoninit-in-angular-c9930c209a42</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/01/angular-assets-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/01/angular-assets-config/" class="post-title-link" itemprop="url">angular-assets-config</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-01 08:48:44" itemprop="dateCreated datePublished" datetime="2024-10-01T08:48:44+08:00">2024-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-27 21:30:02" itemprop="dateModified" datetime="2024-11-27T21:30:02+08:00">2024-11-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>How Angular handles assets file such as images, fonts and other static files in the project.</p>
<h2 id="Angular-18"><a href="#Angular-18" class="headerlink" title="Angular 18+"></a>Angular 18+</h2><p>The following config from <code>angular.json</code> indicates that the Angular builder will copy everything under <code>public</code> folder to the outputPath: <code>dist</code> folder.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>So</p>
<ol>
<li>Put your logo file(angular.svg) under <code>public</code> folder</li>
<li>In your component file, you can just use it as below:<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;angular.svg&quot;</span> alt=<span class="string">&quot;Angular Logo&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
To verify whether the image was in the final build, you can run the following command and check the <code>dist</code> folder under project root.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng build</span><br></pre></td></tr></table></figure></li>
</ol>
<p>If you want to use the old way, you can config <code>angular.json</code> file as below, in this config, we copy everything under <code>src/assets</code> folder to <code>dist</code> folder.(Note, if you omit the <code>output</code> option, the assets folder will not copied, it only copy <code>images</code> folder)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;public&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;glob&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;input&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/assets&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;output&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/assets&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>Then use it in your component file as below:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;assets/images/angular.svg&quot;</span> alt=<span class="string">&quot;Angular Logo&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Before-Angular-18"><a href="#Before-Angular-18" class="headerlink" title="Before Angular 18"></a>Before Angular 18</h2><p><code>angular.json</code> config</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="string">&quot;src/favicon.ico&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&quot;src/assets&quot;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>Asset file path: <code>src/assets/images/angular.svg</code></p>
<p>Use it in your component file as below:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;assets/images/angular.svg&quot;</span> alt=<span class="string">&quot;Angular Logo&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a target="_blank" rel="noopener" href="https://angular.dev/reference/configs/workspace-config#assets-configuration">https://angular.dev/reference/configs/workspace-config#assets-configuration</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/29/angular-proxy-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/29/angular-proxy-config/" class="post-title-link" itemprop="url">angular-proxy-config</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-09-29 20:49:25" itemprop="dateCreated datePublished" datetime="2024-09-29T20:49:25+08:00">2024-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-28 12:57:24" itemprop="dateModified" datetime="2024-11-28T12:57:24+08:00">2024-11-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>When you are developing an Angular application, you may need to call some APIs from the backend server. But in the development environment, the backend server may not be ready yet, or you want to use a local backend server for testing. In this case, you can use the proxy configuration to redirect the API requests to another server.</p>
<h2 id="1-Create-proxy-file"><a href="#1-Create-proxy-file" class="headerlink" title="1. Create proxy file"></a>1. Create proxy file</h2><p>Create a new file named <code>proxy.conf.json</code> in the root <code>src</code> folder of your Angular project. The content of the file should look like this:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;/api&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:3000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;secure&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>In this example, we are redirecting all requests that start with <code>/api</code> to <code>http://localhost:3000</code>. You can change the target URL to your backend server address.</p>
<h2 id="2-Update-angular-json"><a href="#2-Update-angular-json" class="headerlink" title="2. Update angular.json"></a>2. Update <code>angular.json</code></h2><p>Open the <code>angular.json</code> file in the root of your Angular project. Find the <code>serve</code> section under <code>projects &gt; your-project-name &gt; architect &gt; serve &gt; configuration &gt; development</code>. Add the <code>proxyConfig</code> option with the path to the <code>proxy.conf.json</code> file.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;builder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@angular-devkit/build-angular:dev-server&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;production&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;browserTarget&quot;</span><span class="punctuation">:</span> <span class="string">&quot;angular-16:build:production&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;development&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;proxyConfig&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src/proxy.conf.json&quot;</span><span class="punctuation">,</span> <span class="comment">// &lt;--- Add this line</span></span><br><span class="line">      <span class="attr">&quot;browserTarget&quot;</span><span class="punctuation">:</span> <span class="string">&quot;angular-16:build:development&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> you can also serve the proxy file in <code>ng serve</code> command as below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng serve --proxy-config src/proxy.conf.json</span><br></pre></td></tr></table></figure>

<h2 id="3-Start-the-development-server"><a href="#3-Start-the-development-server" class="headerlink" title="3. Start the development server"></a>3. Start the development server</h2><p>Now you can start the development server with the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ng serve</span><br></pre></td></tr></table></figure>

<h2 id="4-Example-of-backend-server-Express"><a href="#4-Example-of-backend-server-Express" class="headerlink" title="4. Example of backend server(Express)"></a>4. Example of backend server(Express)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sample user information</span></span><br><span class="line"><span class="keyword">const</span> userInfo = &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;John Doe&#x27;</span>,</span><br><span class="line">    <span class="attr">email</span>: <span class="string">&#x27;john.doe@example.com&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the /api/user route</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/user&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(userInfo);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start the server</span></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is running on http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h2 id="5-Troubleshooting"><a href="#5-Troubleshooting" class="headerlink" title="5. Troubleshooting"></a>5. Troubleshooting</h2><ol>
<li>Make sure your backend server is running on the specified target URL. you can test your api from the browser or using tools like Postman to make sure it works.</li>
<li>Don’t call backend api directly, only calls made to dev server will be proxied.<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetchUser</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="property">get</span>&lt;<span class="built_in">any</span>&gt;(<span class="string">&#x27;/api/user&#x27;</span>); <span class="comment">// OK </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchUser</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="property">get</span>&lt;<span class="built_in">any</span>&gt;(<span class="string">&#x27;http://localhost:4200/api/user&#x27;</span>); <span class="comment">// OK </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchUser</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="property">get</span>&lt;<span class="built_in">any</span>&gt;(<span class="string">&#x27;http://localhost:3000/api/user&#x27;</span>); <span class="comment">// Won&#x27;t work! </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>Make sure the path of proxy config file is correct in <code>angular.json</code> file.</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/28/npm-install-production/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/28/npm-install-production/" class="post-title-link" itemprop="url">npm-install-production</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-09-28 12:37:23 / Modified: 12:38:13" itemprop="dateCreated datePublished" datetime="2024-09-28T12:37:23+08:00">2024-09-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>The <code>npm install --production</code> command is used to install only the dependencies listed under the <code>dependencies</code> section in the <code>package.json</code> file, excluding the <code>devDependencies</code>. This is typically used in production environments where you want to avoid installing unnecessary development tools and libraries.</p>
<p>Here is a brief explanation of when and why you might use <code>npm install --production</code>:</p>
<ol>
<li><p><strong>Production Deployment</strong>: When deploying an application to a production environment, you often want to minimize the size of the deployment package and reduce the number of installed packages to only those necessary for running the application. This helps in improving performance and security.</p>
</li>
<li><p><strong>Server Environments</strong>: In server environments where the application is running, you generally do not need development tools like testing frameworks, linters, or build tools. Using <code>npm install --production</code> ensures that only the essential packages are installed.</p>
</li>
<li><p><strong>Docker Images</strong>: When building Docker images for your application, using <code>npm install --production</code> can help create smaller and more efficient images by excluding development dependencies.</p>
</li>
</ol>
<p>Example usage:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --production</span><br></pre></td></tr></table></figure>

<p>This command will read the <code>package.json</code> file and install only the packages listed under <code>dependencies</code>, ignoring those under <code>devDependencies</code>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/28/rxjs-function-timeout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/28/rxjs-function-timeout/" class="post-title-link" itemprop="url">rxjs-function-timeout</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-09-28 12:11:46 / Modified: 12:37:05" itemprop="dateCreated datePublished" datetime="2024-09-28T12:11:46+08:00">2024-09-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In <code>RxJS</code>, there is a <a target="_blank" rel="noopener" href="https://rxjs.dev/api/index/function/timeout"><code>timeout</code></a> operator, it’s used to throw an error if the source observable does not emit a value within a specified timeout duration.</p>
<h2 id="Use-case"><a href="#Use-case" class="headerlink" title="Use case"></a>Use case</h2><p>In Angular, the HttpClient service is used to make HTTP requests. Sometimes, we want to set a timeout for the request, if the request does not complete within the specified time, we want to cancel the request and show an error message to the user.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpClient</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; catchError, timeout &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; throwError &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123;</span><br><span class="line">  <span class="attr">providedIn</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="keyword">private</span> http: HttpClient</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&#x27;https://example.com/api/data&#x27;</span>).<span class="title function_">pipe</span>(</span><br><span class="line">      <span class="title function_">timeout</span>(<span class="number">10000</span>), <span class="comment">// 10 seconds</span></span><br><span class="line">      <span class="title function_">catchError</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// Handle timeout or other errors</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Request timed out or failed&#x27;</span>, error);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">throwError</span>(error);</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But, wait, what if I want to add this timeout for all my requests? Do I need to add the <code>timeout</code> operator to every request? The answer is no, you can create an interceptor to add the <code>timeout</code> operator to all requests.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">HttpEvent</span>,</span><br><span class="line">  <span class="title class_">HttpHandler</span>,</span><br><span class="line">  <span class="title class_">HttpInterceptor</span>,</span><br><span class="line">  <span class="title class_">HttpRequest</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; timeout &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">DEFAULT_TIMEOUT</span> = <span class="keyword">new</span> <span class="title class_">InjectionToken</span>&lt;<span class="built_in">number</span>&gt;(<span class="string">&#x27;defaultTimeout&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TimeoutInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HttpInterceptor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="meta">@Inject</span>(DEFAULT_TIMEOUT) <span class="keyword">protected</span> defaultTimeout: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">intercept</span>(</span><br><span class="line">    <span class="attr">req</span>: <span class="title class_">HttpRequest</span>&lt;<span class="built_in">any</span>&gt;,</span><br><span class="line">    <span class="attr">next</span>: <span class="title class_">HttpHandler</span></span><br><span class="line">  ): <span class="title class_">Observable</span>&lt;<span class="title class_">HttpEvent</span>&lt;<span class="built_in">any</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> next.<span class="title function_">handle</span>(req).<span class="title function_">pipe</span>(<span class="title function_">timeout</span>(<span class="variable language_">this</span>.<span class="property">defaultTimeout</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Don’t forget to add the interceptor to the providers array in the <code>AppModule</code>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">HTTP_INTERCEPTORS</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TimeoutInterceptor</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./timeout.interceptor&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="attr">providers</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">provide</span>: <span class="variable constant_">HTTP_INTERCEPTORS</span>,</span><br><span class="line">      <span class="attr">useClass</span>: <span class="title class_">TimeoutInterceptor</span>,</span><br><span class="line">      <span class="attr">multi</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">provide</span>: <span class="variable constant_">DEFAULT_TIMEOUT</span>, <span class="attr">useValue</span>: <span class="number">30000</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Now, all your HTTP requests will have a timeout of 10 seconds.</p>
<p>But, what if I want to set different timeout values for some specific requests? You can add a custom header to the request and check it in the interceptor, if custom header <code>timeout</code> exists, use the custom timeout value, otherwise use the default timeout value.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Injectable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">HttpEvent</span>,</span><br><span class="line">  <span class="title class_">HttpHandler</span>,</span><br><span class="line">  <span class="title class_">HttpInterceptor</span>,</span><br><span class="line">  <span class="title class_">HttpRequest</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Observable</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">TimeoutInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HttpInterceptor</span> &#123;</span><br><span class="line">  <span class="title function_">intercept</span>(</span><br><span class="line">    <span class="attr">req</span>: <span class="title class_">HttpRequest</span>&lt;<span class="built_in">any</span>&gt;,</span><br><span class="line">    <span class="attr">next</span>: <span class="title class_">HttpHandler</span></span><br><span class="line">  ): <span class="title class_">Observable</span>&lt;<span class="title class_">HttpEvent</span>&lt;<span class="built_in">any</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> timeoutValue = req.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&#x27;timeout&#x27;</span>) || <span class="variable language_">this</span>.<span class="property">defaultTimeout</span>;</span><br><span class="line">    <span class="keyword">const</span> timeoutValueNumeric = <span class="title class_">Number</span>(timeoutValue);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next.<span class="title function_">handle</span>(req).<span class="title function_">pipe</span>(<span class="title function_">timeout</span>(timeoutValueNumeric));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, you can set the timeout value in the request headers.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">HttpHeaders</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common/http&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> headers = <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>().<span class="title function_">set</span>(<span class="string">&#x27;timeout&#x27;</span>, <span class="string">&#x27;5000&#x27;</span>); <span class="comment">// 5 seconds</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">http</span>.<span class="title function_">get</span>(<span class="string">&#x27;https://example.com/api/data&#x27;</span>, &#123; headers &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li><a target="_blank" rel="noopener" href="https://rxjs.dev/api/index/function/timeout">https://rxjs.dev/api/index/function/timeout</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/45938931/default-and-specific-request-timeout">https://stackoverflow.com/questions/45938931/default-and-specific-request-timeout</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/20/jest-mockxxxonce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/20/jest-mockxxxonce/" class="post-title-link" itemprop="url">jest-mockXXXOnce</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-09-20 19:24:41 / Modified: 19:52:04" itemprop="dateCreated datePublished" datetime="2024-09-20T19:24:41+08:00">2024-09-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>There are lots of mockXXXOnce functions in Jest API, for example:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://jestjs.io/docs/mock-function-api#mockfnmockimplementationoncefn">mockImplementationOnce</a></li>
<li><a target="_blank" rel="noopener" href="https://jestjs.io/docs/mock-function-api#mockfnmockreturnvalueoncevalue">mockReturnValueOnce</a></li>
<li><a target="_blank" rel="noopener" href="https://jestjs.io/docs/mock-function-api#mockfnmockresolvedvalueoncevalue">mockResolvedValueOnce</a></li>
</ul>
<p>These functions are only mocked on the first call, all the subsequent calls will use the original implementations or return the original values.</p>
<p>Be careful when using such functions, it may not be what you want, take the following code as example:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">AppComponent</span> &#123;</span><br><span class="line">  title = <span class="string">&#x27;jest-demo&#x27;</span>;</span><br><span class="line">  lastTime = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">getIdleTime</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>.<span class="property">lastTime</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">getDuration</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">getIdleTime</span>() &gt; <span class="number">5</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;5+ hours&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="title function_">getIdleTime</span>() &gt;= <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;1 ~ 5 hours&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;in an hour&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here are the test codes, the first one pass test, but the second one will failed. Do you know why?</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">`should return 5+ hours`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fixture = <span class="title class_">TestBed</span>.<span class="title function_">createComponent</span>(<span class="title class_">AppComponent</span>);</span><br><span class="line">  <span class="keyword">const</span> component = fixture.<span class="property">componentInstance</span>;</span><br><span class="line">  jest.<span class="title function_">spyOn</span>(component, <span class="string">&#x27;getIdleTime&#x27;</span>).<span class="title function_">mockImplementationOnce</span>(<span class="function">() =&gt;</span> <span class="number">6</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="title function_">expect</span>(component.<span class="title function_">getDuration</span>()).<span class="title function_">toBe</span>(<span class="string">&#x27;5+ hours&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">`should return 1 ~ 5 hours`</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fixture = <span class="title class_">TestBed</span>.<span class="title function_">createComponent</span>(<span class="title class_">AppComponent</span>);</span><br><span class="line">  <span class="keyword">const</span> component = fixture.<span class="property">componentInstance</span>;</span><br><span class="line">  jest.<span class="title function_">spyOn</span>(component, <span class="string">&#x27;getIdleTime&#x27;</span>).<span class="title function_">mockImplementationOnce</span>(<span class="function">() =&gt;</span> <span class="number">4</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="title function_">expect</span>(component.<span class="title function_">getDuration</span>()).<span class="title function_">toBe</span>(<span class="string">&#x27;1 ~ 5 hours&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Because the first test case only reach the first <code>if</code> branch in <code>getDuration</code> function, it only call <code>getIdleTime</code> once. So there is no problem.</p>
<p>But the second test case need to reach the second <code>if</code> branch in <code>getDuration</code> function, but the mock only take effect in the first if branch, the second branch will still use the original implementation of <code>getIdleTime</code> function, so the test failed.</p>
<p>To fix this issue, you can use <code>mockImplementation</code> instead of <code>mockImplementationOnce</code> in the second test case.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/19/nx-library-types/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Philip Zhang">
      <meta itemprop="description" content="青春都一餉，忍把浮名換了代碼輕狂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Philip">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/19/nx-library-types/" class="post-title-link" itemprop="url">nx-library-types</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-09-19 09:40:06" itemprop="dateCreated datePublished" datetime="2024-09-19T09:40:06+08:00">2024-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-12-16 20:55:33" itemprop="dateModified" datetime="2024-12-16T20:55:33+08:00">2024-12-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Nx-Library-Types-by-functionality"><a href="#Nx-Library-Types-by-functionality" class="headerlink" title="Nx Library Types by functionality"></a>Nx Library Types by functionality</h2><h3 id="Feature-library"><a href="#Feature-library" class="headerlink" title="Feature library"></a>Feature library</h3><p>此类library主要负责和业务相关的组件和页面等等。</p>
<h3 id="UI-library"><a href="#UI-library" class="headerlink" title="UI library"></a>UI library</h3><p>此类Library主要是负责和UI相关的功能。</p>
<h3 id="Data-access-library"><a href="#Data-access-library" class="headerlink" title="Data access library"></a>Data access library</h3><p>此类library主要负责和数据相关的功能，比如和后端API交互，数据处理等。</p>
<h3 id="Utility-library"><a href="#Utility-library" class="headerlink" title="Utility library"></a>Utility library</h3><p>此类library主要负责工具和辅助功能，比如一些通用的函数，服务等。</p>
<h2 id="Nx-library-types-by-buildable-and-publishable"><a href="#Nx-library-types-by-buildable-and-publishable" class="headerlink" title="Nx library types by buildable and publishable"></a>Nx library types by buildable and publishable</h2><h3 id="Workspace-library-Normal-library"><a href="#Workspace-library-Normal-library" class="headerlink" title="Workspace library(Normal library)"></a>Workspace library(Normal library)</h3><p>Create without any options, it’s a normal library.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nx g @nx/angular:lib libName</span><br></pre></td></tr></table></figure>
<ul>
<li>No <code>ng-packagr</code> file generated.</li>
<li>No <code>package.json</code> file generated .</li>
<li>No <code>targets/build</code> section in <code>project.json</code> file.</li>
</ul>
<p>This type of libraries is intended to be used within the monorepo. It was imported by apps or other libraries in the same monorepo. It can’t be builded or published independently.</p>
<h3 id="Buildable-library"><a href="#Buildable-library" class="headerlink" title="Buildable library"></a>Buildable library</h3><p>Create by adding <code>buildable</code> option.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nx g @nx/angular:lib libName --buildable</span><br></pre></td></tr></table></figure>
<ul>
<li>Add <code>ng-packagr</code> file to root of the library.</li>
<li>Add <code>package.json</code> file to root of the library.</li>
<li><code>name</code> property in <code>package.json</code> is the <code>libName</code>.</li>
<li>Add <code>targets/build</code> section in <code>project.json</code> file.</li>
<li>Executor of build is: <code>&quot;executor&quot;: &quot;@nx/angular:ng-packagr-lite&quot;</code></li>
</ul>
<p><code>Buildable</code> libraries are similar to “publishable libraries” described above. Their scope however is not to distribute or publish them to some external registry. Thus they might not be optimized for bundling and distribution.</p>
<p><code>Buildable</code> libraries are mostly used for producing some pre-compiled output that can be directly referenced from an Nx workspace application without the need to again compile it. A typical scenario is to leverage Nx’s incremental building capabilities.</p>
<h3 id="Publishable-library"><a href="#Publishable-library" class="headerlink" title="Publishable library"></a>Publishable library</h3><p>Create by adding <code>publishable</code> and <code>importPath</code> option. <code>importPath</code> is the path that the library will be imported from, will be used as name of the package.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nx g @nx/angular:lib libName --publishable --importPath=@myorg/libName</span><br></pre></td></tr></table></figure>
<ul>
<li>Add <code>ng-packagr</code> file to root of the library.</li>
<li>Add <code>package.json</code> file to root of the library.</li>
<li><code>name</code> property in <code>package.json</code> is the <code>importPath</code>.</li>
<li>Add <code>targets/build</code> section in <code>project.json</code> file.</li>
<li>Executor of build is: <code>&quot;executor&quot;: &quot;@nx/angular:package&quot;</code></li>
</ul>
<p><code>Publishable</code> libraries is intended to be published outside of the monorepo, and can be imported by other projects.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://nx.dev/concepts/decisions/project-dependency-rules">https://nx.dev/concepts/decisions/project-dependency-rules</a></li>
<li><a target="_blank" rel="noopener" href="https://nx.dev/concepts/buildable-and-publishable-libraries">https://nx.dev/concepts/buildable-and-publishable-libraries</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Philip Zhang</p>
  <div class="site-description" itemprop="description">青春都一餉，忍把浮名換了代碼輕狂。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">249</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">354</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Philip Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
